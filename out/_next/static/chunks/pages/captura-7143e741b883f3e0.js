(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[554],{4042:(a,e,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/captura",function(){return t(2293)}])},2293:(a,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>d});var o=t(4848),r=t(6540),n=t(6715),c=t(4335),s=t(6890),i=t.n(s);function d(){let[a,e]=(0,r.useState)(!1),[t,s]=(0,r.useState)(!1),[d,l]=(0,r.useState)(""),[u,p]=(0,r.useState)(!1),[m,_]=(0,r.useState)(!1),[h,j]=(0,r.useState)(!1),[f,g]=(0,r.useState)(null),[x,b]=(0,r.useState)(!1),[N,k]=(0,r.useState)(!1),[v,C]=(0,r.useState)(!1),[w,y]=(0,r.useState)(""),B=(0,r.useRef)(null),S=(0,n.useRouter)();(0,r.useEffect)(()=>{let a=navigator.userAgent||navigator.vendor||window.opera;return e(/android|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(a)),async function(){try{let a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});B.current&&(B.current.srcObject=a)}catch(a){console.error("Error al acceder a la c\xe1mara:",a),l("No se pudo acceder a la c\xe1mara. Verifica los permisos."),p(!0)}}(),()=>{B.current&&B.current.srcObject&&B.current.srcObject.getTracks().forEach(a=>a.stop())}},[]);let E=()=>{j(!0),setTimeout(()=>j(!1),300)},P=async()=>{b(!1),k(!0);try{let a=await O(f.blob),e=await I(a),t=await A(e);await H(e,f.blob),y("Se ha notificado a ".concat(t,", residente del departamento ").concat(e,".")),C(!0)}catch(a){console.log("Error en el flujo:",a),l("Imagen Inv\xe1lida"),p(!0)}finally{k(!1)}},O=async a=>{let e=new FormData;return e.append("image",a,"photo.jpg"),(await c.A.post("http://34.46.252.163/api/process-image/",e)).data.text},I=async a=>(await c.A.post("http://35.193.164.187/api/analyze-text/",{text:a})).data.openai_depto,A=async a=>(await c.A.get("http://34.29.123.189/api/residente/",{params:{codigo_departamento:a}})).data.nombre_completo,H=async(a,e)=>{let t=new FormData;t.append("codigo_departamento",a),t.append("image",e,"photo.jpg"),await c.A.post("http://146.148.75.57/api/notifications/send/",t,{headers:{"Content-Type":"multipart/form-data"}})};return(0,o.jsxs)("div",{className:a?i().mobileContainer:i().desktopContainer,children:[!a&&(0,o.jsx)("div",{className:i().desktopHeader,children:(0,o.jsx)("button",{className:"".concat(i().backButton),onClick:()=>S.push("/"),children:"Regresar al men\xfa"})}),a&&(0,o.jsx)("div",{className:i().mobileHeader,children:(0,o.jsx)("button",{className:"".concat(i().closeButton," ").concat(i().animateCloseButton),onClick:()=>S.push("/"),children:"âœ•"})}),h&&(0,o.jsx)("div",{className:i().flash}),x&&(0,o.jsx)("div",{className:i().modal,children:(0,o.jsxs)("div",{className:i().modalContent,children:[(0,o.jsx)("img",{src:f.url,alt:"Foto capturada",className:i().capturedImage}),(0,o.jsx)("p",{children:"\xbfEsta es la foto que desea enviar?"}),(0,o.jsxs)("div",{className:i().modalButtons,children:[(0,o.jsx)("button",{onClick:P,className:"".concat(i().modalButton," ").concat(i().primary),children:"S\xed"}),(0,o.jsx)("button",{onClick:()=>b(!1),className:"".concat(i().modalButton," ").concat(i().secondary),children:"No"})]})]})}),N&&(0,o.jsx)("div",{className:i().modal,children:(0,o.jsx)("div",{className:i().modalContent,children:(0,o.jsx)("p",{children:"Procesando imagen..."})})}),v&&(0,o.jsx)("div",{className:i().modal,children:(0,o.jsxs)("div",{className:i().modalContent,children:[(0,o.jsx)("p",{children:w}),(0,o.jsx)("button",{onClick:()=>C(!1),className:"".concat(i().modalButton," ").concat(i().single),children:"Aceptar"})]})}),(0,o.jsx)("video",{ref:B,autoPlay:!0,playsInline:!0,className:a?i().mobileVideo:i().desktopVideo}),(0,o.jsx)("button",{onClick:()=>{try{if(E(),!B.current)return;let a=document.createElement("canvas");a.width=B.current.videoWidth,a.height=B.current.videoHeight,a.getContext("2d").drawImage(B.current,0,0,a.width,a.height),a.toBlob(a=>{let e=URL.createObjectURL(a);g({blob:a,url:e}),b(!0)})}catch(a){console.log("No se pudo capturar la imagen",a)}},className:"".concat(a?i().mobileCaptureButton:i().desktopCaptureButton),disabled:t,children:(0,o.jsx)("i",{className:"fas fa-camera","aria-hidden":"true"})}),u&&(0,o.jsx)("div",{className:"".concat(i().errorPopup," ").concat(m?i().fadeOutPopup:""),children:(0,o.jsxs)("div",{className:i().errorPopupContent,children:[(0,o.jsx)("h3",{children:"Error"}),(0,o.jsx)("p",{children:d}),(0,o.jsx)("button",{onClick:()=>{_(!0),setTimeout(()=>{p(!1),_(!1)},300)},children:"Cerrar"})]})})]})}},6890:a=>{a.exports={desktopContainer:"captura_desktopContainer__avMIS",desktopHeader:"captura_desktopHeader__8wCly",backButton:"captura_backButton__w3dKm",desktopVideo:"captura_desktopVideo__TeegK",desktopCaptureButton:"captura_desktopCaptureButton__8rjS5",errorPopup:"captura_errorPopup__EJegr",errorPopupContent:"captura_errorPopupContent__0AQjQ",fadeOutPopup:"captura_fadeOutPopup__0Nh4k",slideOut:"captura_slideOut__Ref7O",flash:"captura_flash__a6pgO",flashEffect:"captura_flashEffect__9hZjI",modal:"captura_modal__MD_6p",modalContent:"captura_modalContent__6bam6",modalButtons:"captura_modalButtons___eHSX",modalButton:"captura_modalButton__HxkY6",primary:"captura_primary__6h_nx",secondary:"captura_secondary___USIE",slideIn:"captura_slideIn__Fgoio",fadeInDown:"captura_fadeInDown__PKtgv"}}},a=>{var e=e=>a(a.s=e);a.O(0,[909,636,593,792],()=>e(4042)),_N_E=a.O()}]);