(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[585],{7032:(e,a,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/QRscanner",function(){return n(9452)}])},9452:(e,a,n)=>{"use strict";n.r(a),n.d(a,{default:()=>d});var r=n(4848),t=n(6540),c=n(6715),s=n(8638),o=n(4335),i=n(1031),l=n.n(i);function d(){let[e,a]=(0,t.useState)(!1),[n,i]=(0,t.useState)(!1),[d,u]=(0,t.useState)(!1),[_,p]=(0,t.useState)(""),h=(0,c.useRouter)();(0,t.useEffect)(()=>{(async()=>{(await s.BarcodeScanner.checkPermission({force:!0})).granted||p("Se necesita permiso para acceder a la c\xe1mara.")})()},[]);let m=async()=>{p("");try{if(!(await s.BarcodeScanner.checkPermission({force:!0})).granted)throw Error("Permiso de c\xe1mara denegado.");s.BarcodeScanner.hideBackground(),a(!0);let e=await s.BarcodeScanner.startScan();e.hasContent?f(e.content):p("No se detect\xf3 contenido en el QR.")}catch(e){p(e.message||"Hubo un error al iniciar el escaneo.")}finally{a(!1),s.BarcodeScanner.showBackground()}},f=async e=>{a(!1),i(!0);try{let a;try{let n=e.replace(/'/g,'"');a=JSON.parse(n)}catch(e){throw Error("El QR escaneado no tiene un formato v\xe1lido.")}if(!a.id_encomienda)throw Error("El QR escaneado no contiene un ID v\xe1lido.");let n=a.id_encomienda,r=await o.A.get("http://34.29.123.189/api/encomienda/".concat(n,"/estado/"));if("Entregado"===r.data.estado){h.push("/entrega-ya-realizada");return}let t=new FormData;t.append("qr_data",n);let c=await o.A.post("http://34.29.123.189/api/analizar-qr/",t,{headers:{"Content-Type":"multipart/form-data"}});if(200===c.status&&c.data.status)u(!0),setTimeout(()=>h.push("/entrega-exitosa"),2e3);else throw Error(c.data.detail||"El QR no es v\xe1lido o no se encontr\xf3 en el sistema.")}catch(e){p(e.message||"Hubo un error al procesar el QR.")}finally{i(!1)}};return(0,r.jsxs)("div",{className:l().container,children:[(0,r.jsx)("div",{className:l().titleWrapper,children:(0,r.jsx)("h1",{className:l().title,children:"Esc\xe1ner de QR"})}),(0,r.jsxs)("div",{className:l().scannerWrapper,children:[e?(0,r.jsx)("p",{className:l().scanningText,children:"Escaneando..."}):(0,r.jsx)("button",{className:l().button,onClick:m,children:"Iniciar Escaneo"}),n&&(0,r.jsx)("div",{className:l().overlay,children:(0,r.jsx)("p",{className:l().loadingText,children:"Analizando QR..."})})]}),_&&(0,r.jsx)("div",{className:l().errorMessage,children:(0,r.jsx)("p",{children:_})}),(0,r.jsx)("button",{className:l().button,onClick:()=>h.push("/"),children:"Volver al inicio"})]})}},1031:e=>{e.exports={container:"QRScanner_container__fL90G",titleWrapper:"QRScanner_titleWrapper__U1p72",title:"QRScanner_title__EsRqt",scannerWrapper:"QRScanner_scannerWrapper__ksXlf",overlay:"QRScanner_overlay__GCXQc",loadingText:"QRScanner_loadingText__KqYcs",fadeBlink:"QRScanner_fadeBlink__AUScn",button:"QRScanner_button__mh1ii"}}},e=>{var a=a=>e(e.s=a);e.O(0,[59,909,638,636,593,792],()=>a(7032)),_N_E=e.O()}]);